<div class="dashboard-modern">
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-modern">
                <i class="bi bi-check2-circle"></i>
            </div>
            <h1>TaskPlus</h1>
        </div>

        <nav class="sidebar-nav">
            <a class="nav-item active" routerLink="/dashboard">
                <i class="bi bi-grid-fill"></i>
                <span>Dashboard</span>
            </a>
            <a class="nav-item" routerLink="/minhas-tarefas">
                <i class="bi bi-list-check"></i>
                <span>Minhas Tarefas</span>
            </a>
            <a class="nav-item" (click)="abrirCategoriaModal()">
                <i class="bi bi-tags-fill"></i>
                <span>Categorias</span>
            </a>
            <a class="nav-item" routerLink="/calendario">
                <i class="bi bi-calendar3"></i>
                <span>Calendário</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">
                    {{ authService.currentUser()?.nome?.charAt(0)?.toUpperCase() }}
                </div>
                <div class="user-info">
                    <span class="user-name">{{ authService.currentUser()?.nome }}</span>
                    <span class="user-email">{{ authService.currentUser()?.email }}</span>
                </div>
            </div>
            <button class="btn-logout" (click)="logout()">
                <i class="bi bi-box-arrow-right"></i>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <header class="top-bar">
            <div class="search-bar">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Pesquisar tarefas...">
            </div>

            <div class="top-actions">
                <div class="notifications-wrapper">
                    <button class="btn-icon" (click)="toggleNotifications()">
                        <i class="bi bi-bell-fill"></i>
                        @if (notificacoes.length > 0) {
                        <span class="badge-notify">{{ notificacoes.length }}</span>
                        }
                    </button>

                    @if (showNotifications) {
                    <div class="notifications-dropdown">
                        <div class="notifications-header">
                            <h3>Notificações</h3>
                            <button class="btn-close-notif" (click)="showNotifications = false">
                                <i class="bi bi-x"></i>
                            </button>
                        </div>
                        <div class="notifications-list">
                            @if (notificacoes.length === 0) {
                            <div class="empty-notifications">
                                <i class="bi bi-bell-slash"></i>
                                <p>Nenhuma notificação</p>
                            </div>
                            } @else {
                            @for (notif of notificacoes; track notif.id) {
                            <div class="notification-item" [class.unread]="!notif.lida">
                                <div class="notif-icon" [class.warning]="notif.tipo === 'warning'"
                                    [class.success]="notif.tipo === 'success'" [class.info]="notif.tipo === 'info'">
                                    <i class="bi" [class.bi-exclamation-triangle]="notif.tipo === 'warning'"
                                        [class.bi-check-circle]="notif.tipo === 'success'"
                                        [class.bi-info-circle]="notif.tipo === 'info'">
                                    </i>
                                </div>
                                <div class="notif-content">
                                    <p class="notif-message">{{ notif.mensagem }}</p>
                                    <span class="notif-time">{{ notif.tempo }}</span>
                                </div>
                            </div>
                            }
                            }
                        </div>
                    </div>
                    }
                </div>

                <button class="btn-primary-modern" (click)="abrirModal()">
                    <i class="bi bi-plus-lg"></i>
                    <span>Nova Tarefa</span>
                </button>
            </div>
        </header>

        <div class="content-area">
            <div class="stats-grid">
                <div class="stat-card stat-total">
                    <div class="stat-icon">
                        <i class="bi bi-list-task"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Total</span>
                        <h3 class="stat-value">{{ estatisticas.total }}</h3>
                    </div>
                </div>

                <div class="stat-card stat-pending">
                    <div class="stat-icon">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Pendentes</span>
                        <h3 class="stat-value">{{ estatisticas.pendentes }}</h3>
                    </div>
                </div>

                <div class="stat-card stat-completed">
                    <div class="stat-icon">
                        <i class="bi bi-check-circle-fill"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Concluídas</span>
                        <h3 class="stat-value">{{ estatisticas.concluidas }}</h3>
                    </div>
                </div>

                <div class="stat-card stat-postponed">
                    <div class="stat-icon">
                        <i class="bi bi-calendar-x"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-label">Adiadas</span>
                        <h3 class="stat-value">{{ estatisticas.adiadas }}</h3>
                    </div>
                </div>
            </div>

            <div class="filter-tabs">
                <button class="tab-btn" [class.active]="filtroAtivo === 'todas'" (click)="filtroAtivo = 'todas'">
                    Todas
                </button>
                <button class="tab-btn" [class.active]="filtroAtivo === 'pendentes'"
                    (click)="filtroAtivo = 'pendentes'">
                    Pendentes
                </button>
                <button class="tab-btn" [class.active]="filtroAtivo === 'concluidas'"
                    (click)="filtroAtivo = 'concluidas'">
                    Concluídas
                </button>
            </div>

            @if (tarefasFiltradas.length === 0) {
            <div class="empty-state">
                <i class="bi bi-inbox"></i>
                <h3>Nenhuma tarefa encontrada</h3>
                <p>Comece criando sua primeira tarefa</p>
                <button class="btn-primary-modern" (click)="abrirModal()">
                    <i class="bi bi-plus-lg"></i>
                    <span>Criar Tarefa</span>
                </button>
            </div>
            } @else {
            <div class="tasks-grid">
                @for (tarefa of tarefasFiltradas; track tarefa.cdTarefa) {
                <div class="task-card" [class.completed]="tarefa.stTarefa === 'CONCLUÍDA'">
                    <div class="task-header">
                        <h4>{{ tarefa.nmTarefa }}</h4>
                        @if (tarefa.categoria) {
                        <span class="task-badge">{{ tarefa.categoria.nmCategoria }}</span>
                        }
                    </div>

                    <div class="task-meta">
                        <span class="task-date">
                            <i class="bi bi-calendar3"></i>
                            {{ formatarData(tarefa.dlTarefa) }}
                        </span>
                        <span class="task-status" [class.status-pending]="tarefa.stTarefa === 'PENDENTE'"
                            [class.status-completed]="tarefa.stTarefa === 'CONCLUÍDA'">
                            {{ tarefa.stTarefa }}
                        </span>
                    </div>

                    <div class="task-actions">
                        @if (tarefa.stTarefa === 'PENDENTE') {
                        <button class="btn-task btn-success" (click)="concluirTarefa(tarefa.cdTarefa!)"
                            title="Concluir">
                            <i class="bi bi-check2"></i>
                        </button>
                        <button class="btn-task btn-warning" (click)="adiarTarefa(tarefa.cdTarefa!)" title="Adiar">
                            <i class="bi bi-clock"></i>
                        </button>
                        <button class="btn-task btn-edit" (click)="abrirModalEdicao(tarefa)" title="Editar">
                            <i class="bi bi-pencil"></i>
                        </button>
                        }
                        <button class="btn-task btn-danger" (click)="deletarTarefa(tarefa.cdTarefa!)" title="Excluir">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                }
            </div>
            }
        </div>
    </main>
</div>

@if (showModal) {
<div class="modal-overlay" (click)="fecharModal()">
    <div class="modal-modern" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>{{ editMode ? 'Editar Tarefa' : 'Nova Tarefa' }}</h3>
            <button class="btn-close-modal" (click)="fecharModal()">
                <i class="bi bi-x"></i>
            </button>
        </div>

        <div class="modal-body">
            <form>
                <div class="form-group">
                    <label>Nome da Tarefa *</label>
                    <input type="text" [(ngModel)]="novaTarefa.nmTarefa" name="nmTarefa"
                        placeholder="Digite o nome da tarefa">
                </div>

                <div class="form-group">
                    <label>Data Limite *</label>
                    <input type="datetime-local" [(ngModel)]="novaTarefa.dlTarefa" name="dlTarefa">
                </div>

                <div class="form-group">
                    <label>Categoria</label>
                    <select [(ngModel)]="novaTarefa.cdCategoria" name="categoria">
                        <option [ngValue]="undefined">Sem categoria</option>
                        @for (cat of categorias(); track cat.cdCategoria) {
                        <option [ngValue]="cat.cdCategoria">{{ cat.nmCategoria }}</option>
                        }
                    </select>
                </div>
            </form>
        </div>

        <div class="modal-footer">
            <button class="btn-secondary-modern" (click)="fecharModal()">
                Cancelar
            </button>
            <button class="btn-primary-modern" (click)="salvarTarefa()">
                {{ editMode ? 'Atualizar' : 'Salvar' }}
            </button>
        </div>
    </div>
</div>
}

@if (showCategoriaModal) {
<div class="modal-overlay" (click)="fecharCategoriaModal()">
    <div class="modal-modern" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Gerenciar Categorias</h3>
            <button class="btn-close-modal" (click)="fecharCategoriaModal()">
                <i class="bi bi-x"></i>
            </button>
        </div>

        <div class="modal-body">
            <div class="form-group">
                <label>Nova Categoria</label>
                <div class="input-group-modern">
                    <input type="text" [(ngModel)]="novaCategoria.nmCategoria" placeholder="Nome da categoria">
                    <button class="btn-add" (click)="salvarCategoria()">
                        <i class="bi bi-plus-lg"></i>
                    </button>
                </div>
            </div>

            <div class="categorias-list">
                @for (cat of categorias(); track cat.cdCategoria) {
                <div class="categoria-item">
                    <span class="categoria-name">
                        <i class="bi bi-tag-fill"></i>
                        {{ cat.nmCategoria }}
                    </span>
                    <button class="btn-delete-cat" (click)="deletarCategoria(cat.cdCategoria!)">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
                }
            </div>
        </div>
    </div>
</div>
}